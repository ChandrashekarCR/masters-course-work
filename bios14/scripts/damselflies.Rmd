---
title: "Damselflies"
author: "Chandrashekar CR"
date: "01-01-2025"
output:
  pdf_document: default
  html_document: default
editor_options: 
  markdown: 
    wrap: 72
---

# Read the data

The data originates from a field monitoring project conducted in Sweden,
focusing on two species of damselflies, Calopteryx splendens and
Calopteryx virgo. These damselflies are commonly found in riverine
aquatic habitats across Europe. Over five consecutive summers (June and
July, 2011–2015), a team of researchers and students conducted repeated
visits to study a single population. The dataset includes several
morphological traits (linear measurements of the body, abdomen, thorax,
and wings), a trait linked to sexual selection (forewing patch length
and width, measured only in C. splendens), and two fitness-related
variables (copulation status as a proxy for mating success, and lifespan
as a proxy for longevity).

To begin, I plan to familiarize myself with damselflies and explore
intriguing questions about their biology and ecology. My initial step
will be a preliminary examination of the dataset to understand its
structure and variables. This will allow me to formulate specific
research questions that can be addressed using the collected data.

Variables included in this dataset are as follows:

-   year : sampled year (unit: year)
-   id : id that is unique to each individual
-   sp : species identity. CS stands for C. splendens, CV stands for C.
    virgo
-   sex : sex of the specimens. Male for male and Female for female.
-   tbl : total body length, which is the distance from the front tip of
    the head to the
-   rear tip of the abdomen (unit: mm)
-   abl : abdomen length (unit: mm)
-   thorl : thorax length (unit: mm)
-   thorw : thorax width (unit: mm)
-   fwl : forewing length (unit: mm)
-   hwl : hindwing length (unit: mm)
-   fpl : forewing patch length (unit: mm). Only in male C. splendens
-   fpw : forewing patch width (unit: mm). Only in male C. splendens
-   cop : copulation status. 0 means that the individual was always
    found without a partner, 1 means that the individual was found while
    mating with a partner at least once
-   marked : date the individual was marked
-   lifespan : days from date marked to date last seen (unit: days)

```{r}
# Clear any pre-stored variables in the environment
rm(list = ls())

# Import Libraries
library(MASS)
library(tidyverse)
library(ggplot2)
library(patchwork)
library(dplyr)
library(MuMIn)

# Load the data
male_CS = read.csv("../data/male_CS.csv")
male_CV = read.csv("../data/male_CV.csv")
female_CS = read.csv("../data/female_CS.csv")
female_CV = read.csv("../data/female_CV.csv")

data = bind_rows(male_CS, male_CV, female_CS, female_CV)

head(data)
```

Following a thorough literature survey, I identified several relevant
papers examining variations in wing pigmentation, wing traits, and other
morphological traits. I intend to conduct a comparative analysis to
determine if both morphological and sexual traits contribute to
copulation status. This research builds upon the findings of Golab and
Brodin's study "Looks or personality: what drives damselfly male mating
success in the wild?" (2023), which will serve as a theoretical
framework to compare whether my results align with their findings.

The research question will be addressed through a sequential analysis of
four sub-questions:

-   What is the relationship between copulation status and individual
    sexual traits (forewing patch length and width)? This will be
    analyzed using analysis of variance (ANOVA).
-   Which predictor better explains copulation status: forewing patch
    length alone, width alone, or both measures combined? This
    relationship will be examined using logistic regression models.
-   How do morphological traits collectively influence copulation
    status? A comprehensive logistic regression analysis will be
    conducted using all available morphological traits as predictors.
-   Which better predicts copulation status: morphological traits,
    sexual traits, or a combination of both? A comparative analysis of
    logistic regression models will be used to evaluate the relative
    importance of these trait categories.

This systematic approach will allow us to understand both the individual
and combined effects of morphological and sexual traits on mating
success.

# Statistical Analysis Plan for Copulation Status Study

## Analysis 1: Sexual Traits and Copulation Status

-   **Variables**: Forewing patch length (FPL) and forewing patch width
    (FPW)
-   **Prerequisites**:
    1.  Verify normality within copulation status groups using:
        -   Shapiro-Wilk tests
-   **Define the ANOVA model**:
    1.  model = lm(x\~groups)

```{r}
# Clear the environment
rm(list = ls())

# Read and prepare the data
male_CS = read.csv("../data/male_CS.csv")
male_CS = male_CS %>% 
  select(fpl, fpw, cop) %>% 
  mutate(cop = as.factor(cop))

# Verify normality within copulation status groups

# 1. ---------- Forewing Patch Width (FPW) ---------------

# Histogram
fpw_histogram = male_CS %>%
  ggplot(aes(x = fpw, fill = cop)) +
  geom_histogram(alpha = 0.6, bins = 15, position = "identity") +
  facet_wrap(~cop) +
  theme_classic() +
  labs(
    title = "Distribution of FPW by Copulation Status", 
    x = "Forewing Patch Width (mm)", 
    y = "Frequency"
  ) +
  theme(
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, hjust = 0.5)
  )

# Save histogram
ggsave(
  "../results/fpw_histogram.png",
  fpw_histogram,
  width = 200,
  height = 100,
  units = "mm",
  dpi = 600
)

# Q-Q Plot
fpw_qq = male_CS %>%
  ggplot(aes(sample = fpw, color = cop)) +
  stat_qq() +
  stat_qq_line() +
  facet_wrap(~cop) +
  theme_classic() +
  labs(
    title = "Q-Q Plot for FPW by Copulation Status",
    x = "Theoretical Quantiles",
    y = "Sample Quantiles"
  ) +
  theme(
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, hjust = 0.5),
    legend.position = "none"
  )

# Save Q-Q plot
ggsave(
  "../results/fpw_qq.png",
  fpw_qq,
  width = 200,
  height = 100,
  units = "mm",
  dpi = 600
)

# 2. ---------- Forewing Patch Length (FPL) ---------------

# Histogram
fpl_histogram = male_CS %>%
  ggplot(aes(x = fpl, fill = cop)) +
  geom_histogram(alpha = 0.6, bins = 15, position = "identity") +
  facet_wrap(~cop) +
  theme_classic() +
  labs(
    title = "Distribution of FPL by Copulation Status",
    x = "Forewing Patch Length (mm)",
    y = "Frequency"
  ) +
  theme(
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, hjust = 0.5)
  )

# Save histogram
ggsave(
  "../results/fpl_histogram.png",
  fpl_histogram,
  width = 200,
  height = 100,
  units = "mm",
  dpi = 600
)

# Q-Q Plot
fpl_qq = male_CS %>%
  ggplot(aes(sample = fpl, color = cop)) +
  stat_qq() +
  stat_qq_line() +
  facet_wrap(~cop) +
  theme_classic() +
  labs(
    title = "Q-Q Plot for FPL by Copulation Status",
    x = "Theoretical Quantiles",
    y = "Sample Quantiles"
  ) +
  theme(
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    plot.title = element_text(size = 16, hjust = 0.5),
    legend.position = "none"
  )

# Save Q-Q plot
ggsave(
  "../results/fpl_qq.png",
  fpl_qq,
  width = 200,
  height = 100,
  units = "mm",
  dpi = 600
)

# Perform ANOVA for FPL
anova_fpl = lm(fpl ~ as.factor(cop), data = male_CS)
anova_result_fpl = anova(anova_fpl)
summary_fpl = summary(anova_fpl)

# Perform ANOVA for FPW
anova_fpw = lm(fpw ~ as.factor(cop), data = male_CS)
anova_result_fpw = anova(anova_fpw)
summary_fpw = summary(anova_fpw)

# Plot the results
fpw_histogram
fpw_qq
fpl_histogram
fpl_qq

# Print ANOVA results
print(anova_result_fpl)
print(summary_fpl)
print(anova_result_fpw)
print(summary_fpw)

```

```{r}
# Clear environment
rm(list = ls())


# Read and prepare data
male_CS = read.csv("../data/male_CS.csv")
male_CS = male_CS %>% 
  select(fpl, fpw, cop) %>% 
  mutate(cop = as.factor(cop))

# Boxplot for FPL
box_fpl = ggplot(male_CS, aes(x = as.factor(cop), y = fpl)) +
  geom_boxplot() +
  labs(x = "Copulation Status", y = "Forewing Patch Length (fpl (mm))") +
  theme_classic() +
  theme(
    axis.text.x = element_text(size = 12),  # Adjusted size of x-axis tick labels
    axis.text.y = element_text(size = 12),  # Adjusted size of y-axis tick labels
    axis.title = element_text(size = 14),   # Adjusted axis titles
    plot.title = element_text(size = 16, hjust = 0.5)  # Adjusted plot title
  )

# Boxplot for FPW
box_fpw = ggplot(male_CS, aes(x = as.factor(cop), y = fpw)) +
  geom_boxplot() +
  labs(x = "Copulation Status", y = "Forewing Patch Width (fpw (mm))") +
  theme_classic() +
  theme(
    axis.text.x = element_text(size = 12),  # Adjusted size of x-axis tick labels
    axis.text.y = element_text(size = 12),  # Adjusted size of y-axis tick labels
    axis.title = element_text(size = 14),   # Adjusted axis titles
    plot.title = element_text(size = 16, hjust = 0.5)  # Adjusted plot title
  )

# Combine plots side by side using patchwork
combined_plots = box_fpl + box_fpw + plot_layout(ncol = 2) +
  plot_annotation(
    title = "Comparison of Forewing Patch Length and Width by Copulation Status", 
    theme = theme(plot.title = element_text(size = 17, hjust = 0.5))  # Adjusted annotation title
  )

# Display combined plots
combined_plots

# Save the plot as a high-resolution PNG for LaTeX document
ggsave(
  "../results/anova_combined_plot.png", 
  combined_plots, 
  width = 200,  # Width in mm
  #height = 80,  # Adjusted height to maintain aspect ratio
  units = "mm", 
  dpi = 600
)

```

## Results of Sexual Traits and Copulation Status

**Response Variables and Predictor Variables:**

-   Response Variables:

    -   FPL (Forewing Patch Length): Continuous variable (unit: mm)
    -   FPW (Forewing Patch Width): Continuous varibale (unit: mm)

-   Predictor Variable:

    -   Copulation Status (cop): Categorical variables with two levels:
        -   0: Individual was always found without a partner.
        -   1: Individual was found mating with partner at least once.

#### Copulation Status \~ FPL

**Variance Explained by the Model**

From the ANOVA table:

-   Sum of Squares (SS):

    -   Copulation Status: 0.924.
    -   Residual: 5937.2.

Total SS = 0.924+5937.2=5938.124.

$R^2 = \frac{\text{SS(Copulation Status)}}{\text{Total SS}} = \frac{0.924}{5938.124} \approx 0.00016$.
This is consistent with the $R^2 = 0.0001556$ from the model summary.

Parameter Estimate and Percentage Difference:

-   Estimate for Copulation Status (1): 0.05961

    -   Reference group mean ($mean_{cop=0}$): 16.658 mm.
    -   Percentage Difference =
        $\frac{0.05961}{16.658} \times 100 \approx 0.36 \%$.

-   Group Means and Standard Errors:

    -   $mean_{cop=0} = 16.658 \pm 0.041mm$
    -   $mean_{cop=1} = 16.718 \pm 0.041mm$

**Percentage Difference Based on Group Means**

$\text{Percentage Difference} = \frac{mean_{cop=1}-mean_{cop=0}}{mean_{cop=0}}\times100 = \frac{16.718-16.658}{16.658}\times100 \approx 0.36 \%$

**F-Statistic and P-values**

F-statistic: 0.316 p-value: 0.5739

This indicates no significant difference in FPL across copulation
statuses.

#### Copulation Status \~ FPW

**Variance Explained by the Model**

From the ANOVA table:

-   Sum of Squares (SS):

    -   Copulation Status: 3.76.
    -   Residual: 336.49

Total SS = 3.76+336.49=340.25.

$R^2 = \frac{\text{SS(Copulation Status)}}{\text{Total SS}} = \frac{3.76}{340.25} \approx 0.01104$.
This is consistent with the $R^2 = 0.01104$ from the model summary.

Parameter Estimate and Percentage Difference:

-   Estimate for Copulation Status (1): -0.12018.

    -   Reference group mean ($mean_{cop=0}$): 9.585 mm.
    -   Percentage Difference =
        $\frac{-0.12018}{9.585} \times 100 \approx -1.25 \%$.

-   Group Means and Standard Errors:

    -   $mean_{cop=0} = 9.585 \pm 0.010mm$
    -   $mean_{cop=1} = 9.465 \pm 0.010mm$

**Percentage Difference Based on Group Means**

$\text{Percentage Difference} = \frac{mean_{cop=1}-mean_{cop=0}}{mean_{cop=0}}\times100 = \frac{9.465-9.585}{9.585}\times100 \approx -1.25 \%$

**F-Statistic and P-values**

F-statistic: 22.69 p-value: $2.04 \times 10^{-6}$

This indicates a significant difference in FPW across copulation
statuses.

**Summary and Interpretation**:

-   For FPL, the variance explained by the model ($R^2 = 0.00016$) is
    negligible, with no significant difference between groups
    ($p=0.5739$).
-   For FPW, the model explains 1.1% of the variance ($R^2 = 0.01104$),
    and the difference between groups is statistically significant
    ($p = 2.04 \times 10^{-6}$).
-   Individuals found mating (cop=1) have slightly smaller FPW, with a
    1.25% reduction compared to individuals always found without a
    partner (cop=0).

## Analysis 2: Sexual Trait Assessments

-   **Model Suite**:
    1.  Single-predictor model: Copulation status \~ FPL
    2.  Single-predictor model: Copulation status \~ FPW
    3.  Combined model: Copulation status \~ FPL + FPW
    4.  Interaction model: Copulation status \~ FPL + FPW + (FPL × FPW)

```{r}
# Clear the environment
rm(list = ls())

# Read the data and filter accordingly
male_CS = read.csv("../data/male_CS.csv")

# Selects only the columns fpl, fpw, and cop from the dataset.
# Converts the `cop` variable (copulation status) into a categorical variable (factor).
male_CS = male_CS %>% 
  select(fpl, fpw, cop) %>% 
  mutate(cop = as.factor(cop))


# Logistic regression model: Copulation status as a function of forewing patch length (fpl)
logit_model_fpl = glm(cop ~ fpl, data = male_CS, family = binomial(link = "logit"))
#summary(logit_model_fpl)


# Logistic regression model: Copulation status as a function of forewing patch width (fpw)
logit_model_fpw = glm(cop ~ fpw, data = male_CS, family = binomial(link = "logit"))
#summary(logit_model_fpw)

# Logistic regression model: Copulation status as a function of both fpl and fpw
logit_model_fpl_fpw = glm(cop ~ fpw + fpl, data = male_CS, family = binomial(link = "logit"))
summary(logit_model_fpl_fpw)

# Logistic regression model: Copulation status with interaction between fpw and fpl
logit_model_interaction = glm(cop ~ fpw + fpl + (fpw * fpl), data = male_CS, family = binomial(link = "logit"))
#summary(logit_model_interaction) # Only the interaction term (fpw*fpl) also gave the AIC score as this model.


# Pseudo R-squared (using MuMIn)
r.squaredGLMM(logit_model_fpl_fpw)

# Tjur's D
y_hat = predict(logit_model_fpl_fpw, type = "response") # Get predicted probabilities

tjur_d = mean(y_hat[male_CS$cop == 1]) - mean(y_hat[male_CS$cop == 0])
tjur_d

```

```{r}
# Calculate mean and standard deviation of predictors
fpw_mean = mean(male_CS$fpw, na.rm = TRUE)
fpw_sd = sd(male_CS$fpw, na.rm = TRUE)
fpl_mean = mean(male_CS$fpl, na.rm = TRUE)
fpl_sd = sd(male_CS$fpl, na.rm = TRUE)

# Predicted probabilities for fpw and fpl (mean wrt SD)
fpw_low = fpw_mean - fpw_sd
fpw_high = fpw_mean + fpw_sd
fpl_low = fpl_mean - fpl_sd
fpl_high = fpl_mean + fpl_sd

# Logistic function for probabilities
logit_to_prob = function(log_odds) {
  return(1 / (1 + exp(-log_odds)))
}

# Base line probabilities for fpw and fpl
prob_fpw_fpl_base = logit_to_prob(4.54030 + (-0.83821 * fpw_mean) + (0.10284 * fpl_mean))

# Predicted probabilities for fpw changes
prob_fpw_low = logit_to_prob(4.54030 + (-0.83821 * fpw_low) + (0.10284 * fpl_mean))
prob_fpw_high = logit_to_prob(4.54030 + (-0.83821 * fpw_high) + (0.10284 * fpl_mean))

# Predicted probabilities for fpl changes
prob_fpl_low = logit_to_prob(4.54030 + (-0.83821 * fpw_mean) + (0.10284 * fpl_low))
prob_fpl_high = logit_to_prob(4.54030 + (-0.83821 * fpw_mean) + (0.10284 * fpl_high))

# Threshold for P(cop=1)=0.5 for fpw and fpl
fpw_threshold = -(4.54030 + (0.10284*fpl_mean))/-0.83821
fpl_threshold = (-4.54030 + (-0.83821*fpw_mean))/ 0.1028

# Results
list(
  fpw_fpl_base = c(prob_fpw_fpl_base),
  fpw_prob_change = c(low = prob_fpw_low, high = prob_fpw_high),
  fpl_prob_change = c(low = prob_fpl_low, high = prob_fpl_high),
  thresholds = c(fpw = fpw_threshold, fpl = fpl_threshold)
)

```

## Results of Analysis 2

The logistic regression equation we will use is as follows -:

$$
\text{logit}(P) = \ln\left(\frac{P}{1-P}\right) = \text{log odds} = \beta_0 + \beta_1 \cdot \text{fpw} + \beta_2 \cdot \text{fpl}
$$

Where:

\- P is the probability of the outcome of interest (copulation success
in this case),

\- (1-P) is the probability of failure (no copulation),

\- $(\frac{P}{1-P})$ represents the odds of success.

We will then convert the log-odds into probabilities using the logistic
function as follows -:

$$
P(cop=1) = \frac{1}{1+e^{-(\beta_0+\beta_1*fpw+\beta_2*fpl)}}
$$

**Estimation and Analysis:**

The coefficients are:

-   Intercept ($\beta_0$): $4.54030\pm1.387484$(unitless, log-odds)
-   Forewing Patch Width ($\beta_1$): $-0.83821\pm0.16028$ (mm, log-odds
    per mm increase)
-   Forewing Patch Length ($\beta_2$): $0.10284\pm0.039380$ (mm,
    log-odds per mm increase)

**Standard Deviation Effect:**

-   The baseline probability of copulation when FPW and FPL are at their
    mean values is 14.6% chance of observing copulation when both FPW
    and FPL are at their average size.
-   When FPW is one SD below its mean (and FPL is at its mean), the
    probability of copulation increases to 19.4%.
-   When FPW is one SD above its mean (and FPL is at its mean), the
    probability of copulation decreases at 10.8%.
-   This shows a negative relationship between FPW and the probability
    of copulation. Smaller FPW is associated with a higher probability
    of observed copulation.
-   When FPL is one SD below its mean (and FPW is at its mean), the
    probability of copulation decreases to 12.6%.
-   When FPL is one SD above its mean (and FPW is at its mean), the
    probability of copulation increases to 17.0%.
-   This shows a positive relationship between FPL and the probability
    of copulation. Larger FPL is associated with a higher probability of
    observed copulation.

**Threshold value for probability of 0.5:**

-   These threshold represent the values of FPW and FPL at which the
    predicted probability of copulation is 0.5 (50%).
-   If FPL is zero, an FPW of approximately of 5.4167 mm would result in
    a 50% probability of observed copulation. Because this value is well
    below the mean value for fpw, it makes sense that the probability of
    copulation is higher when fpw is one SD below the mean.
-   The threshold of -44.1492 for FPL is biologically meaningless. It is
    negative and far outside the realistic range of FPL values. This
    indicates that, within the observed range of FPL and given the
    model, FPL alone will never drive the probability of copulation to
    0.5, when fpw is held at its mean.

**Pseudo** $R^2$ (R2m = 0.029, R2c = 0.029):

Since you do not have random effects in the model, the marginal R² (R2m)
and conditional R² (R2c) are the same. A value of 0.029 means that your
model (FPW and FPL) explains only about 2.9% of the variance in
copulation status. This is a very low value, indicating that other
factors not included in your model are likely much more influential in
determining whether an individual is observed copulating.

**Tjur's D (0.014):**

Tjur's D is 0.014. This indicates that the average predicted probability
of copulation for individuals observed copulating is only 1.4% higher
than the average predicted probability for individuals not observed
copulating. This is a very small difference, suggesting that the model
has weak discriminatory power between the two groups (copulating vs. not
copulating).

**Overall Biological Interpretation:**

Our analysis reveals distinct relationships between forewing patch
dimensions and copulation success, highlighting the complex interplay of
sexual traits in mating dynamics:

-   Width (FPW): Negatively correlated with copulation probability,
    possibly due to female preferences, trade-offs with other fitness
    traits, or links to unmeasured characteristics.
-   Length (FPL): Positively correlated with copulation probability,
    potentially reflecting male quality or mechanical advantages during
    mating.

## Analysis 3: Morphological Trait Assessment

-   **Preliminary Steps**:
    1.  Address multicollinearity:
        -   Calculate Variance Inflation Factors (VIF)
        -   Remove redundant predictors
    2.  Standardize continuous variables
-   **Model Development**:
    -   Implement stepwise selection (forward/backward)
    -   Explore key trait interactions
-   **Model Validation**:
    -   Calculate McFadden's pseudo R²

```{r}
# Clear the environment
rm(list = ls())

# Import libraries
library(car)

# Read the data and filter accordingly
male_CS = read.csv("../data/male_CS.csv")
male_CS = male_CS %>% 
  select(tbl, abl, thorl,thorw,fwl,hwl,cop) %>% 
  mutate(cop = as.factor(cop))

# Calculate VIF: VIF > 5 or 10: Indicates multicollinearity; consider removing the variable.
# Fit an initial logistic regression model
initial_model = glm(cop ~ tbl + abl + thorl + thorw + fwl, data = male_CS, family = binomial) # Removed hwl (hind wing length) as that had the largest value.
                     

# Calculate VIF
vif(initial_model)

# Stepwise selection
final_model = step(glm(cop ~ tbl + abl + thorl + thorw + fwl, 
                        data = male_CS, family = binomial),
                    direction = "both")
#summary(final_model) The interaction model has a better AIC score. So we will analyze only that.

# Step 3: Add interaction terms
interaction_model = glm(cop ~ (thorl * thorw) + fwl + tbl, 
                         data = male_CS, family = binomial)
summary(interaction_model)

# Confusion Matrix
male_CS = male_CS %>%
  mutate(predicted_prob = predict(interaction_model, type = "response"),
         predicted_class = ifelse(predicted_prob > 0.5, 1, 0))


# Pseudo R-squared (using MuMIn)
r.squaredGLMM(interaction_model)

# Tjur's D
y_hat = predict(interaction_model, type = "response") # Get predicted probabilities

tjur_d = mean(y_hat[male_CS$cop == 1]) - mean(y_hat[male_CS$cop == 0])
tjur_d
```

```{r}
# Clear the environment
rm(list = ls())


# Read the data and filter
male_CS = read.csv("../data/male_CS.csv") %>%
  select(tbl, abl, thorl, thorw, fwl, hwl, cop) %>%
  mutate(cop = as.factor(cop))

# Interaction model
interaction_model = glm(cop ~ (thorl * thorw) + fwl + tbl, 
                         data = male_CS, family = binomial)

# Mean and standard deviation of predictors
thorl_mean = mean(male_CS$thorl, na.rm = TRUE)
thorl_sd = sd(male_CS$thorl, na.rm = TRUE)
thorw_mean = mean(male_CS$thorw, na.rm = TRUE)
thorw_sd = sd(male_CS$thorw, na.rm = TRUE)
fwl_mean = mean(male_CS$fwl, na.rm = TRUE)
fwl_sd = sd(male_CS$fwl, na.rm = TRUE)
tbl_mean = mean(male_CS$tbl, na.rm = TRUE)
tbl_sd = sd(male_CS$tbl, na.rm = TRUE)

# Define logistic function
logit_to_prob = function(log_odds) {
  return(1 / (1 + exp(-log_odds)))
}

# Base probability
prob_base = logit_to_prob(-9.51364 + 
                            (1.44451 * thorl_mean) + 
                            (3.29692 * thorw_mean) + 
                            (0.22905 * fwl_mean) + 
                            (-0.16208 * tbl_mean) + 
                            (-0.61031 * thorl_mean * thorw_mean))

# Predicted probabilities for thorl wrt SD
prob_thorl_low = logit_to_prob(-9.51364 + 
                                (1.44451 * (thorl_mean - thorl_sd)) + 
                                (3.29692 * thorw_mean) + 
                                (0.22905 * fwl_mean) + 
                                (-0.16208 * tbl_mean) + 
                                (-0.61031 * (thorl_mean - thorl_sd) * thorw_mean))

prob_thorl_high = logit_to_prob(-9.51364 + 
                                 (1.44451 * (thorl_mean + thorl_sd)) + 
                                 (3.29692 * thorw_mean) + 
                                 (0.22905 * fwl_mean) + 
                                 (-0.16208 * tbl_mean) + 
                                 (-0.61031 * (thorl_mean + thorl_sd) * thorw_mean))

# Predicted probabilities for thorw wrt SD
prob_thorw_low = logit_to_prob(-9.51364 + 
                                (1.44451 * thorl_mean) + 
                                (3.29692 * (thorw_mean - thorw_sd)) + 
                                (0.22905 * fwl_mean) + 
                                (-0.16208 * tbl_mean) + 
                                (-0.61031 * thorl_mean * (thorw_mean - thorw_sd)))

prob_thorw_high = logit_to_prob(-9.51364 + 
                                 (1.44451 * thorl_mean) + 
                                 (3.29692 * (thorw_mean + thorw_sd)) + 
                                 (0.22905 * fwl_mean) + 
                                 (-0.16208 * tbl_mean) + 
                                 (-0.61031 * thorl_mean * (thorw_mean + thorw_sd)))

# Predicted probabilities for fwl wrt SD
prob_fwl_low = logit_to_prob(-9.51364 + 
                                (1.44451 * thorl_mean) + 
                                (3.29692 * thorw_mean) + 
                                (0.22905 * (fwl_mean - fwl_sd)) + 
                                (-0.16208 * tbl_mean) + 
                                (-0.61031 * thorl_mean * thorw_mean))

prob_fwl_high = logit_to_prob(-9.51364 + 
                                (1.44451 * thorl_mean) + 
                                (3.29692 * thorw_mean) + 
                                (0.22905 * (fwl_mean + fwl_sd)) + 
                                (-0.16208 * tbl_mean) + 
                                (-0.61031 * thorl_mean * thorw_mean))

# Predicted probabilities for tbl wrt SD
prob_tbl_low = logit_to_prob(-9.51364 + 
                                (1.44451 * thorl_mean) + 
                                (3.29692 * thorw_mean) + 
                                (0.22905 * fwl_mean) + 
                                (-0.16208 * (tbl_mean - tbl_sd)) + 
                                (-0.61031 * thorl_mean * thorw_mean))

prob_tbl_high = logit_to_prob(-9.51364 + 
                                (1.44451 * thorl_mean) + 
                                (3.29692 * thorw_mean) + 
                                (0.22905 * fwl_mean) + 
                                (-0.16208 * (tbl_mean + tbl_sd)) + 
                                (-0.61031 * thorl_mean * thorw_mean))


# Thresholds for P(cop=1)=0.5
thorl_threshold = (-(-9.51364 + (3.29692 * thorw_mean) + 
                     (0.22905 * fwl_mean) + 
                     (-0.16208 * tbl_mean)) / 
                   (1.44451 + (-0.61031 * thorw_mean)))

thorw_threshold = (-(-9.51364 + (1.44451 * thorl_mean) + 
                     (0.22905 * fwl_mean) + 
                     (-0.16208 * tbl_mean)) / 
                   (3.29692 + (-0.61031 * thorl_mean)))

# Threshold for forewing length (fwl)
fwl_threshold = (-(-(-9.51364) + 
                    (1.44451 * thorl_mean) + 
                    (3.29692 * thorw_mean) + 
                    (-0.16208 * tbl_mean) + 
                    (-0.61031 * thorl_mean * thorw_mean)) / 
                  0.22905)

# Threshold for tibia length (tbl)
tbl_threshold = (-(-(-9.51364) + 
                    (1.44451 * thorl_mean) + 
                    (3.29692 * thorw_mean) + 
                    (0.22905 * fwl_mean) + 
                    (-0.61031 * thorl_mean * thorw_mean)) / 
                  -0.16208)

# Results
list(
  base_probability = prob_base,
  thorl_prob_change = c(low = prob_thorl_low, high = prob_thorl_high),
  thorw_prob_change = c(low = prob_thorw_low, high = prob_thorw_high),
  fwl_prob_change = c(low = prob_fwl_low, high = prob_fwl_high),
  tbl_prob_change = c(low = prob_tbl_low, high = prob_tbl_high),
  thresholds = c(thorl = thorl_threshold, thorw = thorw_threshold, fwl = fwl_threshold, tbl = tbl_threshold)
)



```

## Results of Analysis 3

The Logistic Regression Equation can be written as -:

$$
\text{logit}(P) = \ln\left(\frac{P}{1-P}\right) = \text{log-odds} = \beta_0 + \beta_1 \cdot \text{thorl} + \beta_2 \cdot \text{thorw} + \beta_3 \cdot \text{fwl} + \beta_4 \cdot \text{tbl} + \beta_5 \cdot (\text{thorl} \cdot \text{thorw}) \\
\text{Where:} \\
P \text{ is the probability of the outcome of interest (copulation success).} \\
1-P \text{ is the probability of failure (no copulation).} \\
\frac{P}{1-P} \text{ is the odds of success.} \\
$$

The probability can be calculated as follows -:

$$
P(cop=1) = \frac{1}{1 + e^{-(\beta_0 + \beta_1*thorl + \beta_2*thorw + \beta_3*fwl + \beta_4*tbl + \beta_5{thorl*throw})}}
$$

**Estimation and Analysis:**

-   Intercept ($\beta_0$): $-9.51364 \pm 2.59719$ (unitless, log-odds)
-   Thorax Length ($\beta_1$): $1.44451 \pm 0.33464$ (mm, log-odds per
    mm increase)
-   Thorax Width ($\beta_2$): $3.29692 \pm 0.55896$ (mm, log-odds per mm
    increase)
-   Forewing Length ($\beta_3$): $0.22905 \pm 0.05440$ (mm, log-odds per
    mm increase)
-   Tarsus Length ($\beta_4$): $-0.16208 \pm 0.04642$ (mm, log-odds per
    mm increase)
-   Interaction (Thorax Length x Thorax Width, $\beta_5$):
    $-0.61031 \pm 0.12063$ (unitless, log-odds)

**Standard Deviation Effect:**

-   The baseline probability of copulation when thorl, thorw, fwl, and
    tbl are at their mean values is 9.6%.
-   When thorax length (thorl) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    increases to 11.7%.
-   When thorl is one SD above its mean, the probability of copulation
    decreases to 7.9%. This suggests a complex relationship between
    thorl and copulation probability, likely influenced by the
    interaction with thorw.
-   When thorax width (thorw) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    increases to 12.0%.
-   When thorw is one SD above its mean, the probability of copulation
    decreases to 7.7%.
-   This also suggests a complex relationship between thorw and
    copulation probability, again likely due to the interaction with
    thorl.
-   When forewing length (fwl) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    decreases to 6.9%.
-   When fwl is one SD above its mean, the probability of copulation
    increases to 13.3%.
-   This indicates a positive relationship between fwl and copulation
    probability. Larger fwl is associated with a higher probability of
    observed copulation.
-   When total length (tbl) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    increases to 11.8%.
-   When tbl is one SD above its mean, the probability of copulation
    decreases to 7.8%. This shows a negative relationship between tbl
    and copulation probability. Larger tbl is associated with a lower
    probability of observed copulation.

**Threshold value for probability of 0.5:**

-thorl (-10.46): This threshold is -10.46 mm. This is biologically
meaningless because thorax length cannot be negative. This indicates
that, given the model and the observed range of the other variables, no
biologically plausible value of thorax length alone, while holding other
variables at their means, will ever result in a 50% probability of
copulation.

-   thorw (-3.62): This threshold is -3.62 mm. Like the thorl threshold,
    this is also biologically meaningless as thorax width cannot be
    negative. This indicates that no biologically plausible value of
    thorax width alone, while holding other variables at their means,
    will result in a 50% probability of copulation.

-   fwl (-44.05): This threshold is -44.05 mm. Again, this is
    biologically meaningless as forewing length cannot be negative. This
    means that within the range of observed values and while holding
    other variables constant at their means, no value of fwl will result
    in a 50% probability of copulation.

-   tbl (147.67): This threshold is 147.67 mm. This value is likely also
    biologically unrealistic, being far larger than any observed tibia
    lengths in your data. It indicates that even if the other variables
    are held at their means, it would require an extremely large tibia
    length to reach a 50% probability of copulation according to this
    model.

**Pseudo R2 (R2m = 0.175, R2c = 0.175):**

Since there are no random effects, the marginal and conditional R² are
the same. A value of 0.175 means that the model explains approximately
17.5% of the variance in copulation status. This is a higher value than
in the previous model, suggesting that including the interaction between
thorax length and width, aswell as fwl and tbl, improves the model's
explanatory power. However, it still means that a substantial portion of
the variation in copulation status is explained by factors not included
in the model.

**Tjur's D (0.119):**

Tjur's D is 0.119. This indicates that the average predicted probability
of copulation for individuals observed copulating is 11.9% higher than
the average predicted probability for individuals not observed
copulating. This is a higher value than in the previous model,
suggesting that this model has better discriminatory power between the
two groups.

## Analysis 4: Trait Category Comparison

-   **Model Categories**:
    1.  Morphological: Copulation status \~ (thorl \* thorw) + fwl + tbl
    2.  Sexual: Copulation status \~ fpw + fpl
    3.  Comprehensive: Copulation status \~ fpw + fpl + (thorl \*
        thorw) + fwl + tbl

```{r}
# Clear environment
rm(list = ls())

# Read the data and filter accordingly
male_CS = read.csv("../data/male_CS.csv")
male_CS = male_CS %>% 
  mutate(cop = as.factor(cop))

# Logistic regression model
# Note to self - I have tried all these model to get an AIC score below 1519.9 and it is just not possible -:
# # Model 1: Simple Main Effects Model (Body Size and Wing Length)
#model1 = glm(cop ~ tbl + thorl + thorw + fwl + hwl, data = male_CS, family = binomial)
# Model 2: Adding Interaction Terms Between Size and Shape
#model2 = glm(cop ~ tbl * thorl + thorl * thorw + fwl * hwl + tbl * fwl, data = male_CS, family = binomial)
# Model 3: Including Lifespan
#model3 = glm(cop ~ tbl + thorl + thorw + fwl + lifespan, data = male_CS, family = binomial)
# Model 4: Combining Forewing Patch Length and Width
#model4 = glm(cop ~ tbl + fpl * fpw + thorl + thorw + fwl, data = male_CS, family = binomial)
# Model 5: Full Model with All Interactions
#model5 = glm(cop ~ tbl * abl * thorl * thorw * fwl * hwl * fpl * fpw * lifespan, data = male_CS, family = binomial)
# Model 6: Size and Shape Focused Model
#model6 = glm(cop ~ thorl * thorw + fpl * fpw + tbl + lifespan, data = male_CS, family = binomial)
# Model 7: Testing the Effects of Individual Wing Dimensions
#model7 = glm(cop ~ fwl * fpl + fwl * fpw + hwl + tbl + thorl, data = male_CS, family = binomial)
# Model 8: Alternative Model with Only Morphological Variables
#model8 = glm(cop ~ tbl + thorl * thorw + fwl * hwl + fpl + fpw, data = male_CS, family = binomial)

comprehensive_model = glm(cop ~ fpw + fpl + (thorl * thorw) + fwl + tbl, 
                           data = male_CS, family = binomial)

# Summary of the model
summary(comprehensive_model)

# Pseudo R-squared (using MuMIn)
r.squaredGLMM(comprehensive_model)

# Tjur's D
y_hat = predict(comprehensive_model, type = "response") # Get predicted probabilities

tjur_d = mean(y_hat[male_CS$cop == 1]) - mean(y_hat[male_CS$cop == 0])
tjur_d


# Note to self:
# I tried scaling the predictor variables and applying standard scaler, and nothing change AIC was the same and the thresholds also were the same but were scaled differently. So I don't think I need to perform any scaling for this.
```

```{r}
# Clear environment
rm(list = ls())


# Read the data and filter
male_CS = read.csv("../data/male_CS.csv") %>%
  mutate(cop = as.factor(cop))

# Comprehensive Interaction Model
comprehensive_model = glm(cop ~ fpw + fpl + (thorl * thorw) + fwl + tbl, 
                           data = male_CS, family = binomial)

# Extract coefficients
intercept = -9.9211330
coef_fpw = -0.3765803
coef_fpl = 0.1691122
coef_thorl = 1.5277422
coef_thorw = 3.4099390
coef_fwl = 0.2536333
coef_tbl = -0.1642272
coef_thorl_thorw = -0.6260531

# Mean and standard deviation of predictors
fpw_mean = mean(male_CS$fpw, na.rm = TRUE)
fpl_mean = mean(male_CS$fpl, na.rm = TRUE)
thorl_mean = mean(male_CS$thorl, na.rm = TRUE)
thorw_mean = mean(male_CS$thorw, na.rm = TRUE)
fwl_mean = mean(male_CS$fwl, na.rm = TRUE)
tbl_mean = mean(male_CS$tbl, na.rm = TRUE)

fpw_sd = sd(male_CS$fpw, na.rm = TRUE)
fpl_sd = sd(male_CS$fpl, na.rm = TRUE)
thorl_sd = sd(male_CS$thorl, na.rm = TRUE)
thorw_sd = sd(male_CS$thorw, na.rm = TRUE)
fwl_sd = sd(male_CS$fwl, na.rm = TRUE)
tbl_sd = sd(male_CS$tbl, na.rm = TRUE)

# Define logistic function
logit_to_prob = function(log_odds) {
  return(1 / (1 + exp(-log_odds)))
}

# Base probability
prob_base = logit_to_prob(intercept + 
                            (coef_fpw * fpw_mean) + 
                            (coef_fpl * fpl_mean) + 
                            (coef_thorl * thorl_mean) + 
                            (coef_thorw * thorw_mean) + 
                            (coef_fwl * fwl_mean) + 
                            (coef_tbl * tbl_mean) + 
                            (coef_thorl_thorw * thorl_mean * thorw_mean))

# Predicted probabilities for fpw wrt SD
prob_fpw_low = logit_to_prob(intercept + 
                               (coef_fpw * (fpw_mean - fpw_sd)) + 
                               (coef_fpl * fpl_mean) + 
                               (coef_thorl * thorl_mean) + 
                               (coef_thorw * thorw_mean) + 
                               (coef_fwl * fwl_mean) + 
                               (coef_tbl * tbl_mean) + 
                               (coef_thorl_thorw * thorl_mean * thorw_mean))

prob_fpw_high = logit_to_prob(intercept + 
                                (coef_fpw * (fpw_mean + fpw_sd)) + 
                                (coef_fpl * fpl_mean) + 
                                (coef_thorl * thorl_mean) + 
                                (coef_thorw * thorw_mean) + 
                                (coef_fwl * fwl_mean) + 
                                (coef_tbl * tbl_mean) + 
                                (coef_thorl_thorw * thorl_mean * thorw_mean))

# Predicted probabilities for fpl wrt SD
prob_fpl_low = logit_to_prob(intercept + 
                               (coef_fpw * fpw_mean) + 
                               (coef_fpl * (fpl_mean - fpl_sd)) + 
                               (coef_thorl * thorl_mean) + 
                               (coef_thorw * thorw_mean) + 
                               (coef_fwl * fwl_mean) + 
                               (coef_tbl * tbl_mean) + 
                               (coef_thorl_thorw * thorl_mean * thorw_mean))

prob_fpl_high = logit_to_prob(intercept + 
                                (coef_fpw * fpw_mean) + 
                                (coef_fpl * (fpl_mean + fpl_sd)) + 
                                (coef_thorl * thorl_mean) + 
                                (coef_thorw * thorw_mean) + 
                                (coef_fwl * fwl_mean) + 
                                (coef_tbl * tbl_mean) + 
                                (coef_thorl_thorw * thorl_mean * thorw_mean))

# Predicted probabilities for thorl wrt SD
prob_thorl_low = logit_to_prob(intercept + 
                                (coef_fpw * fpw_mean) + 
                                (coef_fpl * fpl_mean) + 
                                (coef_thorl * (thorl_mean - thorl_sd)) + 
                                (coef_thorw * thorw_mean) + 
                                (coef_fwl * fwl_mean) + 
                                (coef_tbl * tbl_mean) + 
                                (coef_thorl_thorw * (thorl_mean - thorl_sd) * thorw_mean))

prob_thorl_high = logit_to_prob(intercept + 
                                 (coef_fpw * fpw_mean) + 
                                 (coef_fpl * fpl_mean) + 
                                 (coef_thorl * (thorl_mean + thorl_sd)) + 
                                 (coef_thorw * thorw_mean) + 
                                 (coef_fwl * fwl_mean) + 
                                 (coef_tbl * tbl_mean) + 
                                 (coef_thorl_thorw * (thorl_mean + thorl_sd) * thorw_mean))

# Predicted probabilities for thorw wrt SD
prob_thorw_low = logit_to_prob(intercept + 
                                (coef_fpw * fpw_mean) + 
                                (coef_fpl * fpl_mean) + 
                                (coef_thorl * thorl_mean) + 
                                (coef_thorw * (thorw_mean - thorw_sd)) + 
                                (coef_fwl * fwl_mean) + 
                                (coef_tbl * tbl_mean) + 
                                (coef_thorl_thorw * thorl_mean * (thorw_mean - thorw_sd)))

prob_thorw_high = logit_to_prob(intercept + 
                                 (coef_fpw * fpw_mean) + 
                                 (coef_fpl * fpl_mean) + 
                                 (coef_thorl * thorl_mean) + 
                                 (coef_thorw * (thorw_mean + thorw_sd)) + 
                                 (coef_fwl * fwl_mean) + 
                                 (coef_tbl * tbl_mean) + 
                                 (coef_thorl_thorw * thorl_mean * (thorw_mean + thorw_sd)))

# Predicted probabilities for fwl wrt SD
prob_fwl_low = logit_to_prob(intercept + 
                               (coef_fpw * fpw_mean) + 
                               (coef_fpl * fpl_mean) + 
                               (coef_thorl * thorl_mean) + 
                               (coef_thorw * thorw_mean) + 
                               (coef_fwl * (fwl_mean - fwl_sd)) + 
                               (coef_tbl * tbl_mean) + 
                               (coef_thorl_thorw * thorl_mean * thorw_mean))

prob_fwl_high = logit_to_prob(intercept + 
                                (coef_fpw * fpw_mean) + 
                                (coef_fpl * fpl_mean) + 
                                (coef_thorl * thorl_mean) + 
                                (coef_thorw * thorw_mean) + 
                                (coef_fwl * (fwl_mean + fwl_sd)) + 
                                (coef_tbl * tbl_mean) + 
                                (coef_thorl_thorw * thorl_mean * thorw_mean))

# Predicted probabilities for tbl wrt SD
prob_tbl_low = logit_to_prob(intercept + 
                               (coef_fpw * fpw_mean) + 
                               (coef_fpl * fpl_mean) + 
                               (coef_thorl * thorl_mean) + 
                               (coef_thorw * thorw_mean) + 
                               (coef_fwl * fwl_mean) + 
                               (coef_tbl * (tbl_mean - tbl_sd)) + 
                               (coef_thorl_thorw * thorl_mean * thorw_mean))

prob_tbl_high = logit_to_prob(intercept + 
                                (coef_fpw * fpw_mean) + 
                                (coef_fpl * fpl_mean) + 
                                (coef_thorl * thorl_mean) + 
                                (coef_thorw * thorw_mean) + 
                                (coef_fwl * fwl_mean) + 
                                (coef_tbl * (tbl_mean + tbl_sd)) + 
                                (coef_thorl_thorw * thorl_mean * thorw_mean))


# Threshold for fpw
fpw_threshold = (-(
  intercept + 
  (coef_fpl * fpl_mean) + 
  (coef_thorl * thorl_mean) + 
  (coef_thorw * thorw_mean) + 
  (coef_fwl * fwl_mean) + 
  (coef_tbl * tbl_mean) + 
  (coef_thorl_thorw * thorl_mean * thorw_mean)
) / coef_fpw)

# Threshold for fpl
fpl_threshold = (-(
  intercept + 
  (coef_fpw * fpw_mean) + 
  (coef_thorl * thorl_mean) + 
  (coef_thorw * thorw_mean) + 
  (coef_fwl * fwl_mean) + 
  (coef_tbl * tbl_mean) + 
  (coef_thorl_thorw * thorl_mean * thorw_mean)
) / coef_fpl)

# Threshold for thorl
thorl_threshold = (-(
  intercept + 
  (coef_fpw * fpw_mean) + 
  (coef_fpl * fpl_mean) + 
  (coef_thorw * thorw_mean) + 
  (coef_fwl * fwl_mean) + 
  (coef_tbl * tbl_mean)
) / (coef_thorl + (coef_thorl_thorw * thorw_mean)))

# Threshold for thorw
thorw_threshold = (-(
  intercept + 
  (coef_fpw * fpw_mean) + 
  (coef_fpl * fpl_mean) + 
  (coef_thorl * thorl_mean) + 
  (coef_fwl * fwl_mean) + 
  (coef_tbl * tbl_mean)
) / (coef_thorw + (coef_thorl_thorw * thorl_mean)))

# Threshold for fwl
fwl_threshold = (-(
  intercept + 
  (coef_fpw * fpw_mean) + 
  (coef_fpl * fpl_mean) + 
  (coef_thorl * thorl_mean) + 
  (coef_thorw * thorw_mean) + 
  (coef_tbl * tbl_mean) + 
  (coef_thorl_thorw * thorl_mean * thorw_mean)
) / coef_fwl)

# Threshold for tbl
tbl_threshold = (-(
  intercept + 
  (coef_fpw * fpw_mean) + 
  (coef_fpl * fpl_mean) + 
  (coef_thorl * thorl_mean) + 
  (coef_thorw * thorw_mean) + 
  (coef_fwl * fwl_mean) + 
  (coef_thorl_thorw * thorl_mean * thorw_mean)
) / coef_tbl)


# Results
list(
  base_probability = prob_base,
  fpw_prob_change = c(low = prob_fpw_low, high = prob_fpw_high),
  fpl_prob_change = c(low = prob_fpl_low, high = prob_fpl_high),
  thorl_prob_change = c(low = prob_thorl_low, high = prob_thorl_high),
  thorw_prob_change = c(low = prob_thorw_low, high = prob_thorw_high),
  fwl_prob_change = c(low = prob_fwl_low, high = prob_fwl_high),
  tbl_prob_change = c(low = prob_tbl_low, high = prob_tbl_high),
  thresholds = c(thorl = thorl_threshold, thorw = thorw_threshold, fwl = fwl_threshold, tbl = tbl_threshold, fpw = fpw_threshold, fpl = fpl_threshold)
)



```

## Results of Analysis 4

The Logistic Regression Equation can be written as -:

$$
\text{logit}(P) = \ln\left(\frac{P}{1-P}\right) = \text{log-odds} = \beta_0 + \beta_1 \cdot \text{fpw} + \beta_2 \cdot \text{fpl} + \beta_3 \cdot \text{thorl} + \beta_4 \cdot \text{thorw} + \beta_5 \cdot \text{fwl} + \beta_6 \cdot \text{tbl} + \beta_7 \cdot (\text{thorl} \cdot \text{thorw}) \\
\text{Where:} \\
P \text{ is the probability of the outcome of interest (copulation success).} \\
1-P \text{ is the probability of failure (no copulation).} \\
\frac{P}{1-P} \text{ is the odds of success.} 
$$

The probability can be calculated as follows -:

$$
P(cop=1) = \frac{1}{1 + e^{-(\beta_0 + \beta_1fpw + \beta_2fpl + \beta_3thorl + \beta_4thorw + \beta_5fwl + \beta_6tbl + \beta_7*(thorl*thorw))}}
$$

**Estimation and Analysis:**

The coefficients are:

-   Intercept ($\beta_0$): −9.92113±2.76539 (unitless, log-odds)
-   Forewing Patch Width ($\beta_1$): −0.37658±0.19694 (mm, log-odds per
    mm increase)
-   Forewing Patch Length ($\beta_2$): 0.16911±0.04585 (mm, log-odds per
    mm increase)
-   Thorax Length ($\beta_3$): 1.52774±0.34341 (mm, log-odds per mm
    increase)
-   Thorax Width ($\beta_4$): 3.40994±0.58007 (mm, log-odds per mm
    increase)
-   Forewing Length ($\beta_5$): 0.25363±0.05464 (mm, log-odds per mm
    increase)
-   Tibia Length ($\beta_6$): −0.16423±0.05569 (mm, log-odds per mm
    increase)
-   Interaction (Thorax Length x Thorax Width, $\beta_7$):
    −0.62605±0.12300 (unitless, log-odds)

**Standard Deviation Effect:**

-   The baseline probability of copulation when fpw, fpl, thorl, thorw,
    and tbl are at their mean values is 9.4%.
-   When forewing patch width (fpw) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    increases to 10.8%.
-   When fpw is one SD above its mean, the probability of copulation
    decreases to 8.2%. This suggests a negative relationship between fpw
    and copulation probability. Smaller fpw is associated with a higher
    probability of observed copulation.
-   When forewing patch length (fpl) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    decreases to 7.2%.
-   When fpl is one SD above its mean, the probability of copulation
    increases to 12.2%. This indicates a positive relationship between
    fpl and copulation probability. Larger fpl is associated with a
    higher probability of observed copulation.
-   When thorax length (thorl) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    increases to 10.8%.
-   When thorl is one SD above its mean, the probability of copulation
    decreases to 8.2%. This suggests a complex relationship between
    thorl and copulation probability, likely influenced by the
    interaction with thorw.
-   When thorax width (thorw) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    increases to 11.7%.
-   When thorw is one SD above its mean, the probability of copulation
    decreases to 7.6%. This also suggests a complex relationship between
    thorw and copulation probability, again likely due to the
    interaction with thorl.
-   When forewing length (fwl) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    decreases to 6.5%.
-   When fwl is one SD above its mean, the probability of copulation
    increases to 13.5%. This indicates a positive relationship between
    fwl and copulation probability. Larger fwl is associated with a
    higher probability of observed copulation.
-   When total length (tbl) is one SD below its mean (and other
    variables are at their means), the probability of copulation
    increases to 11.6%.
-   When tbl is one SD above its mean, the probability of copulation
    decreases to 7.6%. This shows a negative relationship between tbl
    and copulation probability. Larger tbl is associated with a lower
    probability of observed copulation.

**Threshold value for probability of 0.5:**

These thresholds represent the values of each predictor at which the
predicted probability of copulation is 0.5 (50%), when all other
predictors are held at their mean values.

-   thorl (-18.14 mm): This threshold is -18.14 mm. Given that the
    observed range of thorl is positive, this threshold is biologically
    meaningless. It falls far outside the possible range of thorax
    length. This means that, within the observed range of the other
    variables and holding them at their means, no biologically plausible
    value of thorl alone will result in a 50% probability of copulation.

-   thorw (-4.01 mm): This threshold is -4.01 mm. This is also
    biologically meaningless as thorax width cannot be negative.
    Therefore, no realistic value of thorw alone, with other variables
    held at their means, will lead to a 50% copulation probability.

-   fwl (38.15 mm): This threshold is 38.15 mm. The observed range of
    fwl is 23 to 38 mm. The calculated threshold of 38.15 mm is at the
    very upper limit of the observed range. This suggests that with
    other variables held at their means, an fwl value at the high end of
    the observed range would result in approximately a 50% probability
    of copulation.

-   tbl (30.33 mm): This threshold is 30.33 mm. The observed range of
    tbl is 37 to 50 mm. The calculated threshold of 30.33 mm is below
    the observed range. This indicates that, given the model, with other
    variables held at their mean values, no observed value of tbl alone
    will result in a 50% probability of copulation.

-   fpw (3.56 mm): This threshold is 3.56 mm. The observed range of fpw
    is 6.39 to 12.5 mm. The calculated threshold of 3.56 mm is well
    below the observed range. This indicates that, with other variables
    at their means, no observed value of fpw alone will result in a 50%
    probability of copulation.

-   fpl (30.03 mm): This threshold is 30.03 mm. The observed range of
    fpl is 11 to 30 mm. The calculated threshold of 30.03 mm is at the
    very upper limit of the observed range. This suggests that with
    other variables held at their means, an fpl value at the high end of
    the observed range would result in approximately a 50% probability
    of copulation.

Only the thresholds for fwl and fpl fall within or at the edge of the
observed ranges of these variables. The thresholds for thorl, thorw, and
fpw are outside the observed ranges, indicating that these variables
alone, when other variables are held at their means, do not drive the
probability of copulation to 50% within the observed data. The fact that
most thresholds are outside the observed data range reinforces the idea
that the probability of copulation is determined by the combination of
predictor values, particularly the interaction between thorl and thorw,
rather than any single predictor acting alone.

**Pseudo R2 (R2m = 0.185, R2c = 0.185):**

Since there are no random effects, the marginal and conditional R² are
the same. A value of 0.185 means that the model explains approximately
18.5% of the variance in copulation status. This is a higher value than
in the previous model, suggesting that including fpw and fpl improves
the model's explanatory power. However, it still means that a
substantial portion of the variation in copulation status is explained
by factors not included in the model.

**Tjur's D (0.128):**

Tjur's D is 0.128. This indicates that the average predicted probability
of copulation for individuals observed copulating is 12.8% higher than
the average predicted probability for individuals not observed
copulating. This is a higher value than in the previous model,
suggesting that this model has better discriminatory power between the
two groups.

```{r}
# Data for plotting predicted probabilities with SD and Base
plot_data = data.frame(
  Variable = rep(c("fpw", "fpl", "thorl", "thorw", "fwl", "tbl"), each = 3),
  Level = rep(c("Below SD", "Base", "Above SD"), times = 6),
  Probability = c(
    prob_fpw_low, prob_base, prob_fpw_high,
    prob_fpl_low, prob_base, prob_fpl_high,
    prob_thorl_low, prob_base, prob_thorl_high,
    prob_thorw_low, prob_base, prob_thorw_high,
    prob_fwl_low, prob_base, prob_fwl_high,
    prob_tbl_low, prob_base, prob_tbl_high
  )
)

# Adjust the order of factor levels to make "Below SD" to the left, and "Above SD" to the right of "Base"
plot_data$Level = factor(plot_data$Level, levels = c("Below SD", "Base", "Above SD"))

# Create the plot
plot = ggplot(plot_data, aes(x = Variable, y = Probability, fill = Level)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  labs(
    title = "Predicted Probabilities for Variables",
    y = "Probability",
    x = "Variables"
  ) +
  scale_fill_manual(
    values = c("Below SD" = "#1f77b4", "Base" = "#f2a900", "Above SD" = "#d62728"),
    breaks = c("Below SD", "Base", "Above SD"),
    labels = c("Below SD", "Base", "Above SD")
  ) +
  theme_classic() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 18),
    axis.text = element_text(size = 14),
    axis.title = element_text(size = 16)
  )

# Display the plot
print(plot)

# Save the plot as a high-resolution PNG
ggsave(
  filename = "../results/predicted_probabilities_plot.png", 
  plot = plot, 
  width = 200,  # Width in mm
  height = 80,  # Adjusted height for document proportions
  units = "mm",
  dpi = 600
)


```

```{r}
# Generate grid of values for thorl and thorw
thorl_seq = seq(thorl_mean - 2 * thorl_sd, thorl_mean + 2 * thorl_sd, length.out = 50)
thorw_seq = seq(thorw_mean - 2 * thorw_sd, thorw_mean + 2 * thorw_sd, length.out = 50)

interaction_data = expand.grid(thorl = thorl_seq, thorw = thorw_seq)

# Predict probabilities
interaction_data$Probability = logit_to_prob(
  intercept + 
    coef_thorl * interaction_data$thorl + 
    coef_thorw * interaction_data$thorw + 
    coef_thorl_thorw * interaction_data$thorl * interaction_data$thorw +
    coef_fpw * fpw_mean +
    coef_fpl * fpl_mean +
    coef_fwl * fwl_mean +
    coef_tbl * tbl_mean
)

# Create contour plot
contour_plot = ggplot(interaction_data, aes(x = thorl, y = thorw, z = Probability)) +
  geom_contour_filled() +
  labs(
    title = "Effect of thorl and thorw Interaction on Predicted Probabilities",
    x = "thorl (mm)",
    y = "thorw (mm)",
    fill = "Probability"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.3, size = 16),  # Centered and adjusted title size
    axis.title = element_text(size = 16),               # Axis title size
    axis.text = element_text(size = 14),                # Axis text size
    legend.title = element_text(size = 14),             # Legend title size
    legend.text = element_text(size = 12)               # Legend text size
  )

# Display the plot
print(contour_plot)

# Save the plot as a high-resolution PNG
ggsave(
  filename = "../results/interaction_contour_plot.png", 
  plot = contour_plot, 
  width = 180,  # Width in mm
  height = 120, # Adjusted height for document proportions
  units = "mm",
  dpi = 600
)

```

```{r}
# Extract coefficients and confidence intervals
coef_summary = summary(comprehensive_model)$coefficients
coef_data = data.frame(
  Term = rownames(coef_summary),
  Estimate = coef_summary[, "Estimate"],
  StdError = coef_summary[, "Std. Error"],
  LowerCI = coef_summary[, "Estimate"] - 1.96 * coef_summary[, "Std. Error"],
  UpperCI = coef_summary[, "Estimate"] + 1.96 * coef_summary[, "Std. Error"]
)

# Plot coefficients
coef_plot = ggplot(coef_data, aes(x = Term, y = Estimate)) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = LowerCI, ymax = UpperCI), width = 0.3, color = "#0072B2") +
  labs(
    title = "Coefficient Estimates with 95% Confidence Intervals",
    y = "Estimate",
    x = "Variables"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 18),  # Centered and scaled title
    axis.title = element_text(size = 16),               # Axis title size
    axis.text = element_text(size = 14),                # Axis text size
    panel.grid.major = element_line(linewidth = 0.5),        # Adjust grid line thickness
    panel.grid.minor = element_blank()                  # Hide minor grid lines
  ) +
  coord_flip()  # Flip coordinates for better readability

# Display the plot
print(coef_plot)

# Save the plot as a high-resolution PNG
ggsave(
  filename = "../results/coefficients_plot.png", 
  plot = coef_plot, 
  width = 200,  # Width in mm for LaTeX integration
  height = 120, # Adjusted height for readability
  units = "mm",
  dpi = 600
)


```

```{r}
# Create a dataframe for thresholds
threshold_data = data.frame(
  Variable = c("fpw", "fpl", "thorl", "thorw", "fwl", "tbl"),
  Threshold = c(fpw_threshold, fpl_threshold, thorl_threshold, thorw_threshold, fwl_threshold, tbl_threshold)
)

# Plot thresholds
threshold_plot = ggplot(threshold_data, aes(x = Variable, y = Threshold)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(
    title = "Thresholds for Variables",
    y = "Threshold Value",
    x = "Variables"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 18),  # Centered and scaled title
    axis.title = element_text(size = 16),               # Axis title size
    axis.text = element_text(size = 14),                # Axis text size
    panel.grid.major = element_blank(),        # Adjust grid line thickness
    panel.grid.minor = element_blank()                  # Hide minor grid lines
  )

# Display the plot
print(threshold_plot)

# Save the plot as a high-resolution PNG
ggsave(
  filename = "../results/threshold_plot.png", 
  plot = threshold_plot, 
  width = 200,  # Width in mm for LaTeX integration
  height = 120, # Adjusted height for readability
  units = "mm",
  dpi = 600
)


```

```{r}
# Read the data and filter accordingly
male_CS = read.csv("../data/male_CS.csv")
scatter_plot = male_CS %>%
  mutate(cop = as.factor(cop)) %>%
  ggplot(aes(x = thorw, y = thorl, colour = cop)) +
  geom_point(size = 3, alpha = 0.8) +  # Adjusted point size and transparency
  theme_classic() +
  labs(
    title = "Scatter Plot of thorl vs thorw by Copulation Status",
    x = "thorw (mm)",  # Added unit for clarity
    y = "thorl (mm)",  # Added unit for clarity
    colour = "Copulation Status"
  ) +
  theme(
    legend.position = "top",  # Position legend at the top
    plot.title = element_text(hjust = 0.5, size = 18),  # Centered and scaled title
    axis.title = element_text(size = 16),              # Adjusted axis title size
    axis.text = element_text(size = 14)                # Adjusted axis text size
  )

# Display the plot
print(scatter_plot)

# Save the plot as a high-resolution PNG
ggsave(
  filename = "../results/thorl_vs_thorw_scatter.png", 
  plot = scatter_plot, 
  width = 200,  # Width in mm for LaTeX integration
  height = 150, # Adjusted height for readability
  units = "mm",
  dpi = 600
)

```
